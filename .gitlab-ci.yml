include:
  - remote: 'https://gitlab.com/cscs-ci/recipes/-/raw/master/templates/v2/.ci-ext-devel.yml'

stages:
  - run

test:
  extends: .uenv-runner-eiger-mc
  tags: [f7t-runner-tds]
  stage: run
  script:
    - echo $(id -un)
    - echo test
  variables:
    CSCS_RUNNER_MODE: 'uenv-builder'
    UENV_LOCAL: 'YES'
    STACK_UARCH: 'zen2'
    STACK_RECIPE: uenv-recipes/prgenv-gnu/24.7
    STACK_NAME: prgenv-gnu/$CI_COMMIT_SHORT_SHA
    SLURM_TIMELIMIT: '01:30:00'

test uenv run:
  extends: .uenv-runner-eiger-mc
  tags: [f7t-runner-tds]
  needs: ['test']
  stage: run
  image: $SCRATCH/gitlab-runner/uenv-images/$CI_PROJECT_NAME/prgenv-gnu/$CI_COMMIT_SHORT_SHA.sqfs
  script:
    - uenv view develop
    - mpic++
