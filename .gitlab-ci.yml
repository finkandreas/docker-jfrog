include:
  - remote: 'https://gitlab.com/cscs-ci/recipes/-/raw/master/templates/v2/.ci-ext-devel.yml'

stages:
  - run

test:
  extends: .uenv-runner-eiger-mc
  tags: [f7t-runner-tds]
  stage: run
  script:
    - echo $(id -un)
    - echo test
  variables:
    CSCS_RUNNER_MODE: 'uenv-builder'
    UENV_LOCAL: 'YES'
    UENV_REPO_PATH: '$$SCRATCH/.uenv-images-ci-$$CLUSTER_NAME-tds'
    STACK_UARCH: 'zen2'
    STACK_RECIPE: uenv-recipes/prgenv-gnu/24.7
    STACK_NAME: prgenv-gnu/24.7
    SLURM_PARTITION: 'debug'
    SLURM_TIMELIMIT: '00:30:00'

test uenv run:
  extends: .uenv-runner-eiger-mc
  tags: [f7t-runner-tds]
  needs: ['test']
  stage: run
  image: 'prgenv-gnu/24.7:$CI_PIPELINE_ID'
  script:
    - uenv view develop
    - mpic++ --version
  variables:
    SLURM_PARTITION: debug
    UENV_REPO_PATH: '$$SCRATCH/.uenv-images-ci-$$CLUSTER_NAME-tds'
